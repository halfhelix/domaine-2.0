---
import { urlFor } from '../../../utils/sanityClient'
const { content } = Astro.props;
console.log(content)

---
<section class="content-blocks" data-inverted={content.invertTextColor ? "true" : "false"} style={`background-color:${content.backgroundColor ? content.backgroundColor.hex : 'transparent'}`}>
  {content.blocks.length > 0 ?
   content.blocks.map((block) => 


    <span class="content-block">
      <div class="media" data-layout={content.blocks.length > 1 ? "half-width" : "full-width"}>

        {block.media.videoURL ?
          <video
            class="video"
            src={block.media.videoURL}
            poster={urlFor(block.media.image).auto('format').url()}
            autoplay
            loop
            muted
          />
        :
        content.blocks.length > 1 ? (
          <img
            class="image half-width"
            width={block.media.imageMetadata.width}
            height={block.media.imageMetadata.height}
            sizes="50vw"
            srcset={`
              ${urlFor(block.media.image).width(400).height(534).auto('format').url()} 400w,
              ${urlFor(block.media.image).width(600).height(800).auto('format').url()} 600w,
              ${urlFor(block.media.image).width(960).height(1280).auto('format').url()} 960w,
              ${urlFor(block.media.image).width(1024).height(1364).auto('format').url()} 1024w,
              ${urlFor(block.media.image).width(1440).height(1920).auto('format').url()} 1440w,
            `}
            src={urlFor(block.media.image).auto('format').url()}
            alt={block.media.image.alt}
            loading="lazy"
          />
        ) : 
          <img
            class="image full-width"
            width={block.media.imageMetadata.width}
            height={block.media.imageMetadata.height}
            sizes="100vw"
            srcset={`
              ${urlFor(block.media.image).width(400).height(200).auto('format').url()} 400w,
              ${urlFor(block.media.image).width(600).height(300).auto('format').url()} 600w,
              ${urlFor(block.media.image).width(960).height(480).auto('format').url()} 960w,
              ${urlFor(block.media.image).width(1024).height(512).auto('format').url()} 1024w,
              ${urlFor(block.media.image).width(1440).height(720).auto('format').url()} 1440w,
              ${urlFor(block.media.image).width(1800).height(900).auto('format').url()} 1800w,
              ${urlFor(block.media.image).width(2048).height(1024).auto('format').url()} 2048w,
              ${urlFor(block.media.image).width(2880).height(1440).auto('format').url()} 2880w,
            `}
            src={urlFor(block.media.image).url()}
            alt={block.media.image.alt}
            loading="lazy"
          />
        }
      </div>
      { block.heading || block.description ?
        <div class="content">
          { block.heading && <h3 class="h5">{block.heading}</h3>}
          { block.description && <p>{block.description}</p>}
        </div>
      : null }
    </span>
    
   )
  : null}
</section>

<style>
  .content-blocks {
    display: flex;
    flex-direction: row;
    padding: var(--page-margin);
    gap: var(--space-md);
  }

  .content-blocks[data-inverted="true"] {
    color: var(--color-reverse);
  }

  .content-block {
    display: flex;
    flex-direction: column;
    gap: var(--space-md);
    flex: 1 1 50%;
  }

  .media {
    border-radius: var(--radius-lg);
    overflow: hidden;
    height: auto;
    /* flex: 1 1 50%; */
  }

  .media[data-layout="full-width"] {
    /* aspect-ratio: 2 / 1; */
    /* flex: 0 1 50%; */
    /* max-height: 80svh; */
  }

  .media[data-layout="half-width"] {
    aspect-ratio: 3 / 4;
    /* flex: 0 1 50%; */
  }

  .image,
  .video {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .content {
    max-width: 60ch;
  }
</style>