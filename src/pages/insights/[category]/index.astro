---
import Layout from '../../../layouts/Layout.astro';
import BlogIndexHero from '../../../components/sections/blog/blogIndex/BlogIndexHero.astro';
import BlogIndexFeed from '../../../components/sections/blog/blogIndex/BlogIndexFeed.astro';
import BlogIndexSidebar from '../../../components/sections/blog/blogIndex/BlogIndexSidebar.astro';
import { getBlogCategories, getBlogPageContent, getBlogPosts } from '../../../utils/sanityClient';
import { any } from 'astro/zod';

// const data = await getBlogPageContent();

interface Props {
	data: any;
  posts: any;
  categories: any,
}

// export const prerender = true;


export async function getStaticPaths() {

  // const pages = await getPages();
  const data = await getBlogPageContent();
  const categories = await getBlogCategories();

  return categories.map((category) => {
    return {
      params: { category: category.slug.current },
      props: { data: data, categories: categories }
    }
  })
}

// const { slug } = Astro.params;

const { category } = Astro.params;
const { data, categories } = Astro.props;

const posts = await getBlogPosts();
---

<Layout 
    title="Insights"
    theme="light"
>
    <BlogIndexHero
        heading={data.heading}
        subheading={data.subheading}
        post={data.featuredPost}
    />

    <div class="blog-index-main">
        
        <BlogIndexSidebar
            content={categories}
            activeCategory={category}
        />

        <BlogIndexFeed
            content={posts.filter(post => post.category.slug.current == category && data.featuredPost.slug.current != post.slug.current)}
        />

    </div>

</Layout>

<script>
  // document.addEventListener("astro:after-swap", (e) => { 
  //     console.log(e)
  //     const scrollPosition = Number(localStorage.getItem('scrollPosition'));
  //     if (scrollPosition) window.scrollTo(0, scrollPosition);
  // });

  // document.addEventListener("astro:before-preparation", () => {
  //     localStorage.setItem('scrollPosition', window.scrollY.toString());
  // });
</script>

<style>
    .blog-index-main {
        display: flex;
        flex-direction: row;
        justify-content: stretch;
        align-items: flex-start;
        padding: var(--space-2xl) 0;
        gap: var(--space-xl);
    }

    @media screen and (max-width: 768px) {

        .blog-index-main {
            flex-direction: column;
        }
    }
</style>
